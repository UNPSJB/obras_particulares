
{% extends 'base.html' %}
{% load staticfiles %}
{% load crispy_forms_tags%}

{% block estilos %}
	<link rel="stylesheet" type="text/css" href="{% static perfil %}">
	<style>
	 /* Style the button that is used to open and close the collapsible content */
	.collapsible {
	  background-color: #eee;
	  color: #444;
	  cursor: pointer;
	  padding: 18px;
	  width: 100%;
	  border: none;
	  text-align: left;
	  outline: none;
	  font-size: 15px;
	}
	/* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
	.active, .collapsible:hover {
	  background-color: #ccc;
	}
	/* Style the collapsible content. Note: hidden by default */
	.content {
	  padding: 0 18px;
	  display: none;
	  overflow: hidden;
	  background-color: #f1f1f1;
	}
	</style>
{% endblock %}


{% block barra %}
	<ul class="sidebar sidebar-1">
		<font size="2">
			<li><a href="#" class="current"><font color="tomato">Director</font></a></li>
			<li><a data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive" onclick='mostrarSubmenu("tareasUsuario"),opcionesUsuario("nada")'>Usuarios <span class="caret"></span></a></li>
				<ul class="sidebar sidebar-2" style="display:none;" id="tareasUsuario">
					<li><a href="#" onclick='opcionesUsuario("alta_usuario")'>Crear Usuario</a></li>
					<li><a href="#" onclick='opcionesUsuario("modificar_usuario_grupo")'>Cambiar usuario de grupo</a></li>
				</ul>
			<li><a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" onclick='mostrarSubmenu("tareasTramite"),opcionesDatosTramite("nada")'>Datos tramite <span class="caret"></span></a></li>
				<ul class="sidebar sidebar-2" style="display:none;" id="tareasTramite">
					<li><a href="#" onclick='opcionesDatosTramite("alta_tipo_documento")'>Crear tipo de documento</a></li>
					<li><a href="#" onclick='opcionesDatosTramite("alta_tipo_de_obra")'>Crear tipo de obra</a></li>
				</ul>
			<!--<li><a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree" onclick='mostrarSubmenu("sin_submenu")'>Otorgar final de obra</a></li>-->
			<li><a data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix" onclick='mostrarSubmenu("sin_submenu")'>Modificar mis datos personales</a></li>
			<li><a data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour" onclick='mostrarSubmenu("consultasInformes")'>Consultas e Informes <span class="caret"></span></a></li>
				<ul class="sidebar sidebar-2" style="display:none;" id="consultasInformes">
					<li><a href="vista_de_tramites">Tramites en curso</a></li>
					<li><a href="vista_de_usuarios">Usuarios por grupo</a></li>
					<li><a href="#">Consulta 3</a></li>
				</ul>
		</font>
	</ul>
{% endblock %}

{% block contenido %}
	<button type="button" class="btn btn-sm btn-collapsible-sidebar" onclick='mostrarBarra()' id="botonOn"> <span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span></button>
	<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true" >
	  <div class="panel">
		<div class="panel-heading box" role="tab" id="headingFive">
		  <h5 class="panel-title">
			<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive" onclick='mostrarSubmenu("tareasUsuario")'>
			  <font color="#ffffff" size="2">Usuarios</font>
			</a>
		  </h5>
		</div>
		<div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
		  <div class="panel-body">
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
							<select class="form-control input-sm " id="opcionesDelUsuario" name="Opciones de usuario" onChange="opcionesUsuario(this.value);">
								<option selected value="nada"> ¿Que desea hacer? </option>
								<option value="alta_usuario">Crear Usuario</option>
								<option value="modificar_usuario_grupo">Cambiar usuario de grupo</option>
							</select>
						</div>
					</div>
				</div>
			</div>
			  <div class="container-fluid" id="alta_usuario" style="display: none;">
				<div class="row">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						<hr>
						<div style="display:none">
							{% block alta_administrativo %}
								{% crispy usuario_persona_form %}
							{% endblock %}
						</div>
						<form method="post" enctype="multipart/form-data"> {% csrf_token %}
							<div id="persona_administrativo" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
							</div>
							<div id="profesional_administrativo" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
							</div>
							<div id="usuario_administrativo" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
							</div>
							<div id="boton_administrativo" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" align="right">
								<button class="btn btn-danger btn-sm" type="reset" title="Borrar datos del formulario">
									Limpiar
								</button>
							</div>
							<br>
						</form>
					</div>
				</div>
			  </div>

			<div class="container-fluid" id="modificar_usuario_grupo" style="display: none;">
				<div class="row">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						<hr>
						<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
							<form  action="" method="" onLoad="myOnLoad()">
								<select class="form-control input-sm" id="usuarios" title="Selecciona nombre del grupo que vas a modificar" onchange="cargarUsuarioSeleccionado()">
									<option selected value=""> ¿Que usuario desea cambiar? </option>
								 </select>
							</form>
						</div>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						<hr>
						<div class="container-fluid">
							<form action= ""  method="post" enctype="multipart/form-data"> {% csrf_token %}
								<div class="row">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="form-group">
											<label for="">Nombre:</label>
											<input class="form-control input-sm" id="nombreUsuarioS" name="nombreempleado" type="text" placeholder="Nombre del usuario seleccionado" title="Nombre del usuario seleccionado"  disabled/>
											<br>
											<label for="">Usuario:</label>
											<input class="form-control input-sm" id="usuarioS" name="usuarioempleado" type="text" placeholder="Usuario seleccionado" title="Usuario seleccionado"  disabled />
										</div>
									</div>

									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="form-group">
											<label for="">Grupos actuales:</label>
											 <select id='gruposActuales' class="form-control" title="Grupos asignados al usuario" size="12" style="height: 120px;" disabled>
												 <option value=""  style="font-weight: bold;"> Grupos del usuario </option>
												 <option value="">  </option>
											</select>
										</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<div class="form-group">
											<label for="">Grupos disponibles:</label>
											 <select id='gruposDisponibles' class="form-control" title="Seleccionar a que grupo desea asignarlo" size="12" style="height: 120px;" disabled>
												 <option value="" selected="selected" style="font-weight: bold;"> Seleccione un nuevo grupo </option>
												 <option value="">  </option>
											</select>
										</div>
									</div>
								</div>
								<div class="container-fluid">
									<br>
									<div class="row">
										<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" align="right">
											<button class="btn btn-danger btn-sm" type="reset" title="Borrar datos del formulario" onclick="eliminarTodosLosGrupos()">
												Limpiar
											</button>
											<a href="javascript:enviar();">
												<button type="button" class="btn btn-primary btn-sm" name="Aceptar">
													  Modificar grupo
												</button>
											</a>
											<!--a href= "" >
												<button class="btn btn-primary btn-sm" type="submit" title="Modificar permisos del grupo">
													Modificar grupo
												</button>
											</a-->
										</div>
									</div>
								</div>
							</form>
							<br>
						</div>
					</div>
				</div>
			</div>
		  </div>
		</div>
	  </div>
	  <div class="panel">
		<div class="panel-heading box" role="tab" id="headingTwo">
		  <h5 class="panel-title">
			<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" onclick='mostrarSubmenu("tareasTramite")'>
			  <font color="#ffffff" size="2">Datos Trámite</font>
			</a>
		  </h5>
		</div>
		<div id="collapseTwo" class="panel-collapse
			{% if submit_name != 'tipo_documento_submit' and submit_name != 'tipo_obra_submit' %}collapse{% endif %}
			" role="tabpanel" aria-labelledby="headingTwo">
			<div class="panel-body">
				<div class="container-fluid">
					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
								<select class="form-control input-sm" id="opcionesDelTramite" name="Opciones de Datos del tramite" onChange="opcionesDatosTramite(this.value);">
									<option selected value="nada"> ¿Que desea hacer? </option>
									<option value="alta_tipo_documento">Crear tipo de documento</option>
									<option value="alta_tipo_de_obra">Crear tipo de obra</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="container-fluid" id="alta_tipo_documento" {% if submit_name != 'tipo_documento_submit' %}class="hide"{% endif %} style="display: none;">
					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<hr>
							<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="display:none">
								{% block alta_tipo_documento %}
									{% crispy tipo_documento_form %}
								{% endblock %}
							</div>
							<form method="post" enctype="multipart/form-data"> {% csrf_token %}
								<div id="tipo" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
								</div>
								<div id="requerido_para" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
								</div>
								<div id="boton_tipo" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" align="right">
									<button class="btn btn-danger btn-sm" type="reset" title="Borrar datos del formulario">
										Limpiar
									</button>
								</div>
								<br>
							</form>
						</div>
					</div>
				</div>
				<div class="container-fluid" id="alta_tipo_de_obra" style="display: none;">
					<div class="row">
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<hr>
							<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4" style="display:none">
								{% block alta_tipo_de_obra %}
									{% crispy tipo_obra_form %}
								{% endblock %}
							</div>
							<form method="post" enctype="multipart/form-data"> {% csrf_token %}
								<div id="nombre_tipo_obra" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
								</div>
								<div id="desc_tipo_obra" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
								</div>
								<div id="categoria_tipo_obra" class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
								</div>
								<div id="boton_tipo_obra" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" align="right">
									<button class="btn btn-danger btn-sm" type="reset" title="Borrar datos del formulario">
										Limpiar
									</button>
								</div>
								<br>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	  </div>
	  <div class="panel">
		<div class="panel-heading box" role="tab" id="headingSix">
		  <h5 class="panel-title">
			<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix" onclick='mostrarSubmenu("sin_submenu")'>
			  <font color="#ffffff" size="2">Datos personales</font>
			</a>
		  </h5>
		</div>
		<div id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix">
		  <div class="panel-body">
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
						<div class="container-fluid">
						<br>
							<form action="" class="" >
								<div class="row">
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
											<div class="form-group">
												<label>Nro. de teléfono:</label>
												<input class="form-control input-sm" id="" name="" type="text" placeholder="Ingresar Nro de telefono" title="Ingresar nuevo Nro de telefono" maxlength="13" autofocus />
											</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
											<div class="form-group">
												<label for="">E-Mail:</label>
												<input class="form-control input-sm" id="" name="" type="email" placeholder="Ingresar e-mail" title="Ingresar nuevo e-mail" maxlength="20" />
											</div>
									</div>
									<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
										<label for="">Cambiar Foto de perfil:</label>
										<br>
										<input class="file" id="perfil" type="file" data-preview-file-type="any" title="Cargar nueva foto de perfil">
									</div>
								</div>
								<div class="container-fluid">
									<br>
									<div class="row">
										<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" align="right">
											<button class="btn btn-primary btn-sm" type="submit" title="Enviar modificación de mis datos">
												Modificar mis datos
											</button>
											<button class="btn btn-danger btn-sm" type="reset" title="Borrar datos del formulario">
												Limpiar
											</button>
										</div>
									</div>
								</div>
							</form>
							<br>
						</div>
					</div>
				</div>
			</div>
		  </div>
		</div>
	  </div>
	  <div class="panel" style="display: none;">
		<div class="panel-heading box" role="tab" id="headingFour">
		  <h5 class="panel-title">
			<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
			  <font color="#ffffff" size="2">Consultas e Informes</font>
			</a>
		  </h5>
		</div>
		<div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
		  <div class="panel-body">
		  </div>
		</div>
	  </div>
	</div>

{% endblock %}

{% block scripts %}

	<script type="text/javascript">
	(function(){
		$(".datepicker").datepicker({
				changeDay: true,
				changeMonth: true,
				changeYear: true,
				yearRange: "1990:2030",
				dateFormat: 'dd/mm/yy'
		});
	})();
	</script>

	<script>
		$("#perfil").fileinput({
			showCaption: false,
			browseClass: "btn btn-primary btn-sm",
			fileType: "any",
			maxFileCount: 1,
			browseLabel: 'Cargar nueva foto de perfil',
			showUpload: false,
			showRemove: false
		});
	</script>

	<script type="text/javascript">
		function opcionesGrupo(id) {
			if (id == "nada") {
				$("#alta_grupo").hide();
				$("#baja_grupo").hide();
				$("#modificar_grupo").hide();
				$("#" + "opcionesDelGrupo").val('nada');
			}
			if (id == "alta_grupo") {
				$("#alta_grupo").show();
				$("#baja_grupo").hide();
				$("#modificar_grupo").hide();
				//esto es por si dejo los submenu
				$("#" + "opcionesDelGrupo").val('alta_grupo');
			}
			if (id == "baja_grupo") {
				$("#alta_grupo").hide();
				$("#modificar_grupo").hide();
				$("#baja_grupo").show();
				//esto es por si dejo los submenu
				$("#" + "opcionesDelGrupo").val('baja_grupo');
			}
			if (id == "modificar_grupo") {
				$("#alta_grupo").hide();
				$("#modificar_grupo").show();
				$("#baja_grupo").hide();
				//esto es por si dejo los submenu
				$("#" + "opcionesDelGrupo").val('modificar_grupo');
			}
		}

		function opcionesUsuario(id) {
			if (id == "nada") {
				$("#alta_usuario").hide();
				$("#modificar_usuario_grupo").hide();
				$("#" + "opcionesDelUsuario").val('nada');
			}
			if (id == "alta_usuario"){
				$("#alta_usuario").show();
				$("#modificar_usuario_grupo").hide();
				$("#" + "opcionesDelUsuario").val('alta_usuario');
			}
			if (id == "modificar_usuario_grupo") {
				$("#alta_usuario").hide();
				$("#modificar_usuario_grupo").show();
				//esto es por si dejo los submenu
				$("#" + "opcionesDelUsuario").val('modificar_usuario_grupo');
			}
		}

		function opcionesDatosTramite(id) {
				if (id == "nada") {
					$("#alta_tipo_documento").hide();
					$("#alta_tipo_de_obra").hide();
					$("#" + "opcionesDelTramite").val('nada');
				}
				if (id == "alta_tipo_documento") {
					$("#alta_tipo_documento").show();
					$("#alta_tipo_de_obra").hide();
					//esto es por si dejo los submenu
					$("#" + "opcionesDelTramite").val('alta_tipo_documento');
				}
				if (id == "alta_tipo_de_obra") {
					$("#alta_tipo_documento").hide();
					$("#alta_tipo_de_obra").show();
					//esto es por si dejo los submenu
					$("#" + "opcionesDelTramite").val('alta_tipo_de_obra');
				}
		}
	</script>

	<script type="text/javascript">
		function mostrarSubmenu(subformulario){
			if(subformulario=="sin_submenu"){
				$('.' + "sidebar-2").hide();
			}
			else{
				var idSubformulario=document.getElementById(subformulario).id;
				if($('#' + idSubformulario).is(':hidden')){
					$('.' + "sidebar-2").hide();
					$('#' + idSubformulario).show();
				}else{
					$('#' + idSubformulario).hide();
				}
			}
		}
	</script>

	<script>
		$('#div_id_dni').appendTo('#persona_administrativo');
		$('#div_id_nombre').appendTo('#persona_administrativo');
		$('#div_id_apellido').appendTo('#persona_administrativo');
		$('#div_id_telefono').appendTo('#persona_administrativo');
		$('#div_id_domicilio').appendTo('#profesional_administrativo');
		$('#div_id_cuil').appendTo('#profesional_administrativo');
		$('#div_id_mail').appendTo('#profesional_administrativo');
		$('#div_id_matricula').appendTo('#profesional_administrativo');
		$('#div_id_usuario').appendTo('#usuario_administrativo');
		$('#div_id_password').appendTo('#usuario_administrativo');
		$('#div_id_grupo').appendTo('#usuario_administrativo')
		$('#submit-id-usuario_persona_submit').appendTo('#boton_administrativo');
		$('#id_password').removeAttr("type");
		$('#id_password').attr("type","password");
		$('.selectmultiple').attr( "size", "6" );
		$('.selectmultiple').append($('<option>',{value:0, text:'Seleccione un grupo'}));
		$('.selectmultiple > option[value="0"]').attr('selected', 'selected');
		var selectList = $('#id_grupo option');
		selectList.sort(function(a,b){
			a = a.value;
			b = b.value;
			return a-b;
		});
		$('#id_grupo').html(selectList);
		$('#alta_tipo_documento #div_id_nombre').appendTo('#tipo')
		$('#alta_tipo_documento #div_id_descripcion').appendTo('#tipo')
		$('#div_id_fecha_alta').appendTo('#tipo')
		$('#div_id_activo').appendTo('#tipo')
		$('#div_id_requerido').appendTo('#requerido_para')
		$('#submit-id-tipo_documento_submit').appendTo('#boton_tipo')
		$('#alta_tipo_de_obra #div_id_nombre').appendTo('#nombre_tipo_obra')
		$('#alta_tipo_de_obra #div_id_descripcion').appendTo('#desc_tipo_obra')
		$('#alta_tipo_de_obra #div_id_categorias').appendTo('#categoria_tipo_obra')
		$('#submit-id-tipo_obra_submit').appendTo('#boton_tipo_obra')
	</script>

	<script>
		usuarios = [];
		grupos = [];
		$(document).ready(function() {
			{% for dtu in datos_usuario %}
				usuarios.push("{{dtu.persona.dni}}");
			{% endfor %}
			usuarios.sort();
			for(var i=0; i < usuarios.length; i++){
				var option = document.createElement("option");
				$(option).html(usuarios[i]);
				$(option).appendTo("#usuarios");
			}
			var sel = document.getElementById("gruposActuales");
			len = sel.length - 1 ;
			for( i = 0;  i < len ; i++) {
  			    sel.remove(2);
    		}
			document.getElementById("nombreUsuarioS").value = '';
			document.getElementById("usuarioS").value = '';
			document.getElementById("gruposDisponibles").disabled=true;
			{% for gr in grupos %}
				grupos.push("{{gr}}");
			{% endfor %}
			grupos.sort();
			for(var i=0; i < grupos.length; i++){
				var option = document.createElement("option");
				$(option).html(grupos[i]);
				$(option).appendTo("#gruposDisponibles");
			}
			document.getElementById("gruposActuales").disabled=true;
		});
		function cargarUsuarioSeleccionado() {
			var sel = document.getElementById("gruposActuales");
			len = sel.length - 1 ;
			for( i = 0;  i < len ; i++) {
  			    sel.remove(2);
    		}
			var elements = document.getElementById("gruposDisponibles").options;
				for(var i = 0; i < elements.length; i++){
				elements[i].selected = false;
			}
			usuario_filtrado_nombre = [];
			usuario_filtrado_usuario = [];
			usuario_filtrado_grupo = [];
    		var x = document.getElementById("usuarios").value;
			{% for uf in datos_usuario %}
				if ("{{uf.persona.dni}}" == document.getElementById("usuarios").value){
					usuario_filtrado_nombre.push("{{uf.persona}}");
				}
			{% endfor %}
			{% for uf in datos_usuario %}
				if ("{{uf.persona.dni}}" == document.getElementById("usuarios").value){
					usuario_filtrado_usuario.push("{{uf}}");
				}
			{% endfor %}
			{% for uf in datos_usuario %}
				if ("{{uf.persona.dni}}" == document.getElementById("usuarios").value){
					{% for gr in uf.groups.values %}
						usuario_filtrado_grupo.push("{{gr.name}}");
					{% endfor %}
				}
			{% endfor %}
    		document.getElementById("nombreUsuarioS").value = usuario_filtrado_nombre[0];
			document.getElementById("usuarioS").value = usuario_filtrado_usuario[0];
			for(var i=0; i < usuario_filtrado_grupo.length; i++){
				var option = document.createElement("option");
				$(option).html(usuario_filtrado_grupo[i]);
				$(option).appendTo("#gruposActuales");
			}
			document.getElementById("gruposDisponibles").disabled=false;
 		}
	</script>

	<script>
		function eliminarTodosLosGrupos(){
			var sel = document.getElementById("gruposActuales");
			len = sel.length - 1 ;
			for( i = 0;  i < len ; i++) {
  			    sel.remove(2);
    		}
			document.getElementById("gruposDisponibles").disabled=true;
			document.getElementById("gruposActuales").disabled=true;
			document.getElementById("usuarios").value = '';
		}
	</script>

	<script>
		function enviar(){
			grupossel = $("#gruposDisponibles").val();
			usuariosel = $("#usuarioS").val();
			url = '/persona/cambiar_usuario_grupo/'+usuariosel+'/'+grupossel;
			location.href = url;
		}
	</script>

{% endblock %}
